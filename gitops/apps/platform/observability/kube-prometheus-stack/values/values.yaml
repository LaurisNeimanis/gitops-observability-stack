crds:
  enabled: false

prometheusOperator:
  enabled: true

prometheus:
  enabled: true
  prometheusSpec:
    replicas: 1
    retention: 15d

alertmanager:
  enabled: true
  
  config:
    global:
      resolve_timeout: 5m

    route:
      receiver: slack-platform
      group_by: ['alertname', 'namespace']
      group_wait: 30s
      group_interval: 5m
      repeat_interval: 4h

      routes:
        # Watchdog is always firing and is used only as a dead-man switch
        - matchers:
            - alertname="Watchdog"
          receiver: "null"

        # EKS control-plane components are managed by AWS and trigger false positives
        - matchers:
            - alertname=~"KubeControllerManagerDown|KubeSchedulerDown"
          receiver: "null"

        - matchers:
            - scope="workload"
          receiver: slack-workload

        - matchers:
            - alertname=~"Kube.*|Prometheus.*|Node.*|Alertmanager.*"
          receiver: slack-platform

    receivers:
      - name: "null"

      - name: slack-platform
        slack_configs:
          - api_url: "<SLACK_WEBHOOK_URL>"
            channel: "#platform-alerts"
            send_resolved: true
            title: "{{ .CommonAnnotations.summary }}"
            text: >-
              {{ range .Alerts -}}
              *Alert:* {{ .Annotations.description }}
              *Severity:* {{ .Labels.severity }}
              *Namespace:* {{ .Labels.namespace }}
              {{ end }}

      - name: slack-workload
        slack_configs:
          - api_url: "<SLACK_WEBHOOK_URL>"
            send_resolved: true
            title: "{{ .CommonAnnotations.summary }}"
            text: >-
              {{ range .Alerts -}}
              *Alert:* {{ .Annotations.description }}
              *Severity:* {{ .Labels.severity }}
              *Namespace:* {{ .Labels.namespace }}
              {{ end }}

grafana:
  enabled: true

  admin:
    existingSecret: grafana-admin

  additionalDataSources:
    - name: Loki
      type: loki
      access: proxy
      url: http://loki.observability.svc:3100
      isDefault: false
      editable: false
